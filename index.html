<!DOCTYPE html>
<html>
  <head>
    <script src="/socket.io/socket.io.js"></script>
  </head>
  <body>
    <div id="player"></div>
    <form id="frm">
        <input id="videoid" type="text" name="">
        <button>Video Açılsın</button>
    </form>
    
    <script>

      form = document.getElementById("frm");
      videoid = document.getElementById("videoid");

      
      
      var socket = io();
      // 2. This code loads the IFrame Player API code asynchronously.
      var tag = document.createElement('script');

      tag.src = "https://www.youtube.com/iframe_api";
      var firstScriptTag = document.getElementsByTagName('script')[0];
      firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

      // 3. This function creates an <iframe> (and YouTube player)
      //    after the API code downloads.
      var player;
      
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
          height: '500',
          width: '100%',
          videoId: '52Rzg1fUM8s',
          playerVars: {
            'playsinline': 1
          },
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }
      
      form.addEventListener("submit",function(e){
          e.preventDefault();
          player.loadVideoById(videoid.value);
          

      });
      var input;
      var counter=0;

      
    

    function onPlayerReady(event) {
      socket.emit('event message', event.data );
      
      if(!counter){
        player.playVideo();
        counter=1;
        socket.emit('player time', event.target.getCurrentTime() );
      }
      
      
      
      
    }
    function onPlayerStateChange(event) {
          socket.emit('event message', event.data );
          socket.emit('player time', event.target.getCurrentTime() );
    }
  
    


    socket.on('event message', function(msg) {
        console.log("playerstate: "+msg);
        if(msg == 1){
            player.playVideo();
        }
        else if(msg == 2){
            player.pauseVideo();
        }
        else if(msg == 3){
            player.playVideo();
        }
        
    });
      
      socket.on('player time',function (time){
        console.log("Socket's time:"+time);
        console.log("Player's time:"+player.getCurrentTime());
      
        if(Math.abs( time - player.getCurrentTime() ) >= 0.2){player.seekTo(time);}
        
            if(time<1){
                time = player.getCurrentTime();
                player.seekTo(time);
            }
                
            
        
      });
    </script>
  </body>
</html>